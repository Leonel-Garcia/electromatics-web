<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diseñador de Puesta a Tierra | Electromatics</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/grounding.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Inline critical layout styles for the new structure */
        .grounding-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }
        .panel-header {
            color: var(--text-primary);
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .hidden-section { display: none !important; }
        
        @media (max-width: 900px) {
            .grounding-layout { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <nav class="container">
            <a href="index.html" class="logo">
                <img src="images/logo.png" alt="Electromatics" style="height: 32px; margin-right: 10px;">
                <span>Electromatics</span>
            </a>
            <div class="desktop-nav">
                <a href="index.html">Inicio</a>
                <a href="que-es-electromatics.html">Qué es</a>
                <a href="para-quien-es.html">Para quién</a>
                <a href="calculos-electricos.html" class="active">Cálculos</a>
                <a href="normativa-electrica.html">Normativa</a>
                <a href="simuladores.html">Simuladores</a>
                <a href="formacion.html">Formación</a>
                <a href="electro-info.html">Tecno-Info</a>
                <a href="apu.html">Presupuestos</a>
                <a href="calculadora.html">App IA</a>
                <a href="#" id="login-btn" class="btn btn-primary" style="padding: 6px 16px; margin-left: 20px; font-size: 14px">Acceder</a>
            </div>
        </nav>
    </header>

    <main class="container" style="margin-top: 40px;">
        <div class="grounding-dashboard">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <div>
                    <h1 style="margin-bottom: 5px; color: var(--electric-blue);">
                        <i class="fa-solid fa-earth-americas"></i> Diseñador de Puesta a Tierra
                    </h1>
                    <p style="color: var(--text-secondary); margin: 0;">
                        Cálculo y Validación Normativa (Fondonorma 200 / IEEE 80)
                    </p>
                </div>
                <button id="btn-guide" class="btn btn-secondary" style="font-size: 0.9rem;">
                    <i class="fa-solid fa-circle-question"></i> Guía & Normas
                </button>
            </div>

            <!-- Application Selector -->
            <div class="app-grid">
                <div class="app-card active" data-type="substation">
                    <i class="fa-solid fa-bolt"></i>
                    <h3>Subestación</h3>
                    <p>Malla IEEE 80 (< 1 Ω)</p>
                </div>
                <div class="app-card" data-type="building">
                    <i class="fa-solid fa-building"></i>
                    <h3>Edificio</h3>
                    <p>Electrodo (< 25 Ω)</p>
                </div>
                <div class="app-card" data-type="industrial">
                    <i class="fa-solid fa-industry"></i>
                    <h3>Industrial</h3>
                    <p>Bta. Tensión (< 5 Ω)</p>
                </div>
                <div class="app-card" data-type="tank">
                    <i class="fa-solid fa-oil-well"></i>
                    <h3>Tanques / Oil</h3>
                    <p>Estática (< 10 Ω)</p>
                </div>
            </div>

            <!-- MAIN WORKSPACE LAYOUT -->
            <div class="grounding-layout">
                
                <!-- === INPUTS PANEL === -->
                <div class="inputs-panel">
                    <div class="panel-header">
                        <i class="fa-solid fa-sliders" style="color: var(--electric-blue);"></i> 1. Datos de Entrada
                    </div>

                    <!-- Project Info -->
                    <div class="calc-section">
                        <div class="calc-header" style="margin-bottom: 15px;">
                            <h2 style="font-size: 1.1rem;"><i class="fa-solid fa-folder"></i> Proyecto</h2>
                        </div>
                        <div class="input-grid" style="gap: 15px;">
                            <input type="text" id="proj-name" class="calc-input" placeholder="Nombre Proyecto">
                            <input type="text" id="proj-loc" class="calc-input" placeholder="Ubicación">
                        </div>
                    </div>

                    <!-- System Params -->
                    <div class="calc-section">
                        <div class="calc-header">
                            <h2 style="font-size: 1.1rem;"><i class="fa-solid fa-server"></i> Sistema Eléctrico</h2>
                        </div>
                        <div class="input-grid">
                            <div class="form-group">
                                <label>Voltaje (kV)</label>
                                <input type="number" id="sys-kv" class="calc-input" value="13.8" step="0.1">
                            </div>
                            <div class="form-group">
                                <label>I. Falla (kA)</label>
                                <input type="number" id="sys-if" class="calc-input" value="3" step="1">
                            </div>
                            <div class="form-group">
                                <label>Tiempo (s)</label>
                                <input type="number" id="sys-tf" class="calc-input" value="0.5" step="0.1">
                            </div>
                        </div>
                    </div>

                    <!-- Soil -->
                    <div class="calc-section">
                        <div class="calc-header">
                            <h2 style="font-size: 1.1rem;"><i class="fa-solid fa-layer-group"></i> Suelo (Wenner)</h2>
                        </div>
                        <div class="input-grid">
                            <div class="form-group">
                                <label>Separación (a) [m]</label>
                                <input type="number" id="wenner-a" class="calc-input" value="3" step="0.5">
                            </div>
                            <div class="form-group">
                                <label>Resistencia (R) [Ω]</label>
                                <input type="number" id="wenner-r" class="calc-input" value="2" step="0.1">
                            </div>
                        </div>
                        <div style="background: rgba(0,0,0,0.2); padding: 10px; border-radius: 6px; text-align: center;">
                            <small class="text-secondary">Resistividad Calculada:</small>
                            <span id="res-rho" style="color: var(--electric-blue); font-weight: bold; margin-left: 10px;">0</span> Ω·m
                        </div>
                    </div>

                    <!-- Surface Layer (IEEE 80 ONLY) -->
                    <div id="section-surface" class="calc-section">
                        <div class="calc-header">
                            <h2 style="font-size: 1.1rem;"><i class="fa-solid fa-cubes-stacked"></i> Capa Superficial (Grava)</h2>
                            <small class="tag" style="background:#4ade80;color:#064e3b; font-size: 0.7rem;">IEEE 80</small>
                        </div>
                        <div class="input-grid">
                            <div class="form-group">
                                <label>Resistividad (ρs)</label>
                                <input type="number" id="surf-rho" class="calc-input" value="2500" step="100">
                            </div>
                            <div class="form-group">
                                <label>Espesor (hs) [m]</label>
                                <input type="number" id="surf-h" class="calc-input" value="0.15" step="0.05">
                            </div>
                        </div>
                    </div>

                    <!-- Geometry -->
                    <div class="calc-section">
                        <div class="calc-header">
                            <h2 style="font-size: 1.1rem;"><i class="fa-solid fa-pencil"></i> Geometría</h2>
                        </div>

                        <!-- Rods -->
                        <h4 style="color: var(--text-secondary); margin: 0 0 10px 0; font-size: 0.9rem;">Electrodo Vertical</h4>
                        <div class="input-grid">
                            <div class="form-group">
                                <label>Longitud (L)</label>
                                <input type="number" id="rod-len" class="calc-input" value="2.44">
                            </div>
                            <div class="form-group">
                                <label>Diámetro</label>
                                <select id="rod-dia" class="calc-input">
                                    <option value="0.625" selected>5/8"</option>
                                    <option value="0.75">3/4"</option>
                                </select>
                            </div>
                        </div>

                        <!-- Grid (Complex inputs for Substation) -->
                        <div id="section-grid-details" style="margin-top: 15px; border-top: 1px dashed var(--border-color); padding-top: 15px;">
                            <h4 style="color: var(--text-secondary); margin: 0 0 10px 0; font-size: 0.9rem;">Malla de Tierra</h4>
                            <div class="input-grid">
                                <div class="form-group">
                                    <label id="txt-area">Área (m²)</label>
                                    <input type="number" id="grid-area" class="calc-input" value="400">
                                </div>
                                <div class="form-group">
                                    <label id="txt-len">L. Conductor (m)</label>
                                    <input type="number" id="grid-len" class="calc-input" value="500">
                                </div>
                            </div>
                            <div class="input-grid">
                                <div class="form-group">
                                    <label id="txt-spacing">Espaciamiento D (m)</label>
                                    <input type="number" id="grid-spacing" class="calc-input" value="2.5">
                                </div>
                                <div class="form-group">
                                    <label id="txt-n">Conductores (n)</label>
                                    <input type="number" id="grid-n" class="calc-input" value="10">
                                </div>
                                <div class="form-group">
                                    <label>Profundidad (m)</label>
                                    <input type="number" id="grid-depth" class="calc-input" value="0.5">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- === RESULTS PANEL === -->
                <div class="results-panel">
                    <div class="panel-header">
                        <i class="fa-solid fa-chart-pie" style="color: var(--success-green);"></i> 2. Resultados
                    </div>

                    <!-- Main Compliance Status -->
                    <div class="calc-section" style="text-align: center; border-left: 5px solid var(--electric-blue); padding: 20px;">
                         <small id="res-label" style="text-transform: uppercase; color: var(--text-secondary);">RESISTENCIA FINAL</small>
                         <div style="font-size: 3.5rem; font-weight: 800; color: var(--white); margin: 10px 0; text-shadow: 0 0 20px rgba(0,229,255,0.3);">
                             <span id="res-main">0.00</span> <span style="font-size: 1.5rem; color: var(--text-secondary);">Ω</span>
                         </div>
                         <div id="compliance-badge" class="compliance-badge" style="font-size: 1.1rem; padding: 8px 20px;">
                             --
                         </div>
                         <div style="margin-top: 15px; font-size: 0.9rem; color: var(--text-secondary);">
                             Meta: <strong id="target-resistance" style="color: var(--text-primary);">--</strong> <span id="standard-ref"></span>
                         </div>
                    </div>

                    <!-- Safety Voltages (HIDDEN for Buildings) -->
                    <div id="section-safety" class="calc-section" style="border-left: 5px solid var(--warning-yellow);">
                        <div class="calc-header">
                            <h2 style="font-size: 1.1rem;"><i class="fa-solid fa-person-falling-burst"></i> Voltajes de Seguridad</h2>
                            <small class="tag" title="Peso del cuerpo humano según IEEE 80 para cálculo de corriente fibrilación">Persona 70kg</small>
                        </div>
                        <table class="grounding-table">
                            <thead>
                                <tr>
                                    <th>Parámetro</th>
                                    <th>Calculado</th>
                                    <th>Máx. Permitido</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><i class="fa-solid fa-hand-pointer"></i> Contacto</td>
                                    <td id="val-touch-calc">-</td>
                                    <td id="val-touch-max" style="color: var(--text-secondary);">-</td>
                                    <td id="status-touch">-</td>
                                </tr>
                                <tr>
                                    <td><i class="fa-solid fa-shoe-prints"></i> Paso</td>
                                    <td id="val-step-calc">-</td>
                                    <td id="val-step-max" style="color: var(--text-secondary);">-</td>
                                    <td id="status-step">-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Technical Details -->
                    <div class="calc-section">
                        <div class="calc-header">
                            <h2 style="font-size: 1.1rem;"><i class="fa-solid fa-list-check"></i> Detalles Técnicos</h2>
                        </div>
                        <table class="grounding-table">
                            <tr>
                                <td>Conductor Tierra</td>
                                <td style="text-align: right;">
                                    <div id="res-conductor" style="font-weight: bold; color: var(--warning-yellow);">--</div>
                                    <small id="res-conductor-awg" style="color: var(--text-secondary);">--</small>
                                </td>
                            </tr>
                            <tr>
                                <td>Resistencia Varilla</td>
                                <td style="text-align: right;"><strong id="res-rod">--</strong> Ω</td>
                            </tr>
                            <tr>
                                <td>Resistencia Malla</td>
                                <td style="text-align: right;"><strong id="res-grid">--</strong> Ω</td>
                            </tr>
                        </table>
                    </div>

                    <!-- Chart -->
                    <div class="calc-section">
                        <div class="chart-container" style="height: 200px;">
                            <canvas id="resistivityChart"></canvas>
                        </div>
                    </div>

                    <button class="btn btn-primary" style="width: 100%; padding: 15px; font-size: 1.1rem;" onclick="Grounding.generatePDF()">
                        <i class="fa-solid fa-file-pdf"></i> DESCARGAR REPORTE
                    </button>

                </div>
            </div>
            
        </div>

        <!-- Usage Guide Modal -->
        <div id="guide-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h2 style="color: var(--electric-blue);">Normas y Criterios</h2>
                <div style="margin-top: 20px;">
                    <h3><i class="fa-solid fa-bolt"></i> IEEE Std 80 (Subestaciones)</h3>
                    <p>El criterio principal NO es la resistencia (aunque se sugiere < 1Ω), sino la seguridad humana ante voltajes de paso y contacto.</p>
                    
                    <h3><i class="fa-solid fa-building"></i> Fondonorma 200 / NEC (Edificios)</h3>
                    <p>Se exige una resistencia a tierra eficaz, típicamente menor a 25 Ω para un solo electrodo (Art 250.56).</p>
                </div>
            </div>
        </div>
    </main>

    <script src="js/grounding.js?v=2.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="js/premium-interactions.js?v=1.0"></script>
</body>
</html>
